<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <title>Stock</title>
    <style>
        body{font-family:"Poppins","Cascadia Mono",sans-serif;background-color:black;color:limegreen;}
        h1{text-align:center;background-color:black;}
        button{width:150px;height:70px;border:none;border-radius:4px;color:navy;background-color:darkgray;transition:all 0.4s ease;}
        button:hover{filter:brightness(0.8);transform:scale(1.2);}
        button:active{filter:brightness(1.1);transform:scale(0.9);}
        #eventLog{margin:10px 0;padding:10px;border:1px solid limegreen;height:80px;overflow-y:auto;font-size:14px;}
        #players{margin:10px 0;font-size:14px;}
    </style>
</head>
<body>
    <h1 id="0">Ruililcu'sStock Simu</h1>
    <h2 id="1">You have 100.00 coin</h2>
    <p id="2">Stock price:10.00 coin</p>
    <p id="3"></p>
    <div id="players"></div>
    <div id="eventLog"></div>
    <canvas id="4" width="400" height="300"></canvas>
    <br>
    <button onclick="buy()" style="background-color:lightcoral">buy 1</button>
    <button onclick="sell()" style="background-color:aquamarine;">sell 1</button>
    <script>
        let money=100,stock=10,instock=0,stocks=[10],tickes=0;
        const _pt0=document.getElementById(0),pt1=document.getElementById(1),pt2=document.getElementById(2),
              pt3=document.getElementById(3),pt4=document.getElementById(4),ctx=pt4.getContext("2d");
        const eventLog=document.getElementById("eventLog"),playersEl=document.getElementById("players");
        const virtualPlayers=[
            {name:"Alice",funds:150,stocks:0,aggressiveness:0.7},
            {name:"Bob",funds:200,stocks:1,aggressiveness:0.4},
            {name:"username003",funds:180,stocks:0,aggressiveness:0.9},
            {name:"copier_of_stonelee1",funds:100,stocks:0,aggressiveness:0.5},
            {name:"copier_of_stonelee2",funds:100,stocks:0,aggressiveness:0.5},
            {name:"copier_of_stonelee3",funds:100,stocks:0,aggressiveness:0.5},
            {name:"steve",funds:1000,stocks:10,aggressiveness:0.5}
        ];
        const randomEvents=[
            {desc:"Market surge: Tech stocks rally",impact:1.15,prob:0.05},
            {desc:"Interest rate hike: Market dip",impact:0.85,prob:0.05},
            {desc:"Corporate scandal: Stock plummet",impact:0.7,prob:0.03},
            {desc:"Positive earnings report: Price jump",impact:1.2,prob:0.04},
            {desc:"Global crisis: Volatility spike",impact:0.9,prob:0.06},
            {desc:"Merger announcement: Stock boost",impact:1.18,prob:0.04},
            {desc:"Inflation fears: Market slowdown",impact:0.88,prob:0.05},
            {desc:"New product launch: Investor optimism",impact:1.12,prob:0.05},
            {desc:"Regulatory change: Industry disruption",impact:0.8,prob:0.03},
            {desc:"No major events: Market stable",impact:1.0,prob:0.5}
        ];

        function updt(){
            if(stocks.length>500)stocks.shift();
            pt1.textContent=`You have ${money.toFixed(2)} coin`;
            pt2.textContent=`Stock price:${stock.toFixed(2)} coin`;
            pt3.textContent=`You have ${instock.toFixed(2)} stocks | Stock value:${(stock*instock).toFixed(2)} coin`;
            updatePlayerDisplay();
            graphics();
        }
        function updatePlayerDisplay(){
            let html="";
            virtualPlayers.forEach(p=>{
                html+=`${p.name}: ${p.funds.toFixed(2)} coin | ${p.stocks} stocks<br>`;
            });
            playersEl.innerHTML=html;
        }
        function triggerRandomEvent(){
            const rand=Math.random();
            let cumulative=0;
            for(const evt of randomEvents){
                cumulative+=evt.prob;
                if(rand<=cumulative){
                    stock*=evt.impact;
                    addEventLog(evt.desc + ` (Price: ${stock.toFixed(2)})`);
                    break;
                }
            }
        }
        function virtualPlayerActions(){
            virtualPlayers.forEach(player=>{
                const rand=Math.random();
                const actionProb=rand*player.aggressiveness;
                if(actionProb>0.7 && player.funds>=stock){
                    const buyQty=Math.floor(Math.random()*5)+1;
                    if(player.funds>=stock*buyQty){
                        player.funds-=stock*buyQty;
                        player.stocks+=buyQty;
                        addEventLog(`${player.name} buys ${buyQty} stocks (Price: ${stock.toFixed(2)})`);
                        stock*=(1 + (buyQty*0.01*player.aggressiveness));
                    }
                }
                if(actionProb<0.3 && player.stocks>0){
                    const sellQty=Math.floor(Math.random()*player.stocks)+1;
                    player.funds+=stock*sellQty;
                    player.stocks-=sellQty;
                    addEventLog(`${player.name} sells ${sellQty} stocks (Price: ${stock.toFixed(2)})`);
                    stock*=(1 - (sellQty*0.01*player.aggressiveness));
                }
            });
        }
        function addEventLog(text){
            const timeStr=`[At ${tickes} tick]`;
            eventLog.innerHTML=`${timeStr} ${text}<br>`+eventLog.innerHTML;
            const lines=eventLog.innerHTML.split('<br>');
            if(lines.length>6)eventLog.innerHTML=lines.slice(0,6).join('<br>');
        }
        function tick(){
            if(Math.random()>0.5)stock*=(Math.random()/25)+1;
            else stock/=(Math.random()/25)+1;
            if(Math.random()<0.01)triggerRandomEvent();
            if(Math.random()<0.015)virtualPlayerActions();
            tickes++;
            stocks.push(stock);
            updt();
        }

        function buy(){
            if(money>stock){
                money-=stock;
                instock++;
                updt();
            }
        }

        function sell(){
            if(instock>0){
                money+=stock;
                instock--;
                updt();
            }
        }

        function boxmuller(){return Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random());}

        function graphics(){
            const maxPrice=Math.max(...stocks);
            const minPrice=Math.min(...stocks);
            const range=maxPrice-minPrice||1; 
            ctx.clearRect(0,0,pt4.width,pt4.height);
            ctx.beginPath();
            ctx.moveTo(0,250-(stocks[0]-minPrice)/range*200);
            for(let i=1;i<stocks.length;i++)
                ctx.lineTo(400*i/stocks.length,250-(stocks[i]-minPrice)/range*200);
            ctx.strokeStyle=stock>12?'green':stock<8?'red':'lemonchiffon';
            ctx.lineWidth=2;
            ctx.stroke();
        }

        let hue=123;
        setInterval(()=>{hue+=0.5;hue%=360;_pt0.style.color=`hsl(${hue},75%,40%)`;},20);
        setInterval(tick,20); 
        updt();
    </script>
</body>
</html>
